{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Desktop/website/ecomerceWebsite/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\nimport { getToken } from 'next-auth/jwt'\n\nexport async function middleware(request: NextRequest) {\n  const { pathname, host } = request.nextUrl\n  \n  // Obtenir le token d'authentification\n  const token = await getToken({ \n    req: request, \n    secret: process.env.NEXTAUTH_SECRET \n  })\n\n  // Extraire le subdomain\n  const mainDomain = process.env.NEXT_PUBLIC_MAIN_DOMAIN || 'localhost:3000'\n  const cleanHost = host.split(':')[0]\n  const cleanMainDomain = mainDomain.split(':')[0]\n  \n  let subdomain: string | null = null\n  \n  if (cleanHost !== cleanMainDomain && cleanHost !== 'localhost') {\n    const parts = cleanHost.split('.')\n    const mainParts = cleanMainDomain.split('.')\n    if (parts.length > mainParts.length) {\n      subdomain = parts[0]\n    }\n  }\n\n  // ==========================================\n  // ROUTES PUBLIQUES (pas besoin d'auth)\n  // ==========================================\n  const publicRoutes = ['/login', '/signup', '/api/auth', '/api/register']\n  const isPublicRoute = publicRoutes.some(route => pathname.startsWith(route))\n  \n  if (isPublicRoute) {\n    return NextResponse.next()\n  }\n\n  // ==========================================\n  // LANDING PAGE (domaine principal sans subdomain)\n  // ==========================================\n  if (!subdomain && pathname === '/') {\n    return NextResponse.next()\n  }\n\n  // ==========================================\n  // STORE FRONTEND (subdomain présent)\n  // ==========================================\n  if (subdomain && !pathname.startsWith('/dashboard') && !pathname.startsWith('/admin')) {\n    // Rediriger vers la page store\n    return NextResponse.rewrite(new URL(`/store/${subdomain}${pathname}`, request.url))\n  }\n\n  // ==========================================\n  // PROTECTION DES ROUTES DASHBOARD\n  // ==========================================\n  if (pathname.startsWith('/dashboard') || pathname.startsWith('/admin')) {\n    // Vérifier si l'utilisateur est authentifié\n    if (!token) {\n      const loginUrl = new URL('/login', request.url)\n      loginUrl.searchParams.set('callbackUrl', pathname)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    // SUPER ADMIN routes\n    if (pathname.startsWith('/admin')) {\n      if (token.role !== 'SUPER_ADMIN') {\n        return NextResponse.redirect(new URL('/dashboard', request.url))\n      }\n    }\n\n    // TENANT ADMIN/USER routes\n    if (pathname.startsWith('/dashboard')) {\n      if (token.role === 'CUSTOMER') {\n        return NextResponse.redirect(new URL('/', request.url))\n      }\n    }\n  }\n\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public (public files)\n     */\n    '/((?!_next/static|_next/image|favicon.ico|public).*)',\n  ],\n}"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,QAAQ,OAAO;IAE1C,sCAAsC;IACtC,MAAM,QAAQ,MAAM,IAAA,yMAAQ,EAAC;QAC3B,KAAK;QACL,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACrC;IAEA,wBAAwB;IACxB,MAAM,aAAa,sDAAuC;IAC1D,MAAM,YAAY,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE;IACpC,MAAM,kBAAkB,WAAW,KAAK,CAAC,IAAI,CAAC,EAAE;IAEhD,IAAI,YAA2B;IAE/B,IAAI,cAAc,mBAAmB,cAAc,aAAa;QAC9D,MAAM,QAAQ,UAAU,KAAK,CAAC;QAC9B,MAAM,YAAY,gBAAgB,KAAK,CAAC;QACxC,IAAI,MAAM,MAAM,GAAG,UAAU,MAAM,EAAE;YACnC,YAAY,KAAK,CAAC,EAAE;QACtB;IACF;IAEA,6CAA6C;IAC7C,uCAAuC;IACvC,6CAA6C;IAC7C,MAAM,eAAe;QAAC;QAAU;QAAW;QAAa;KAAgB;IACxE,MAAM,gBAAgB,aAAa,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC;IAErE,IAAI,eAAe;QACjB,OAAO,yOAAY,CAAC,IAAI;IAC1B;IAEA,6CAA6C;IAC7C,kDAAkD;IAClD,6CAA6C;IAC7C,IAAI,CAAC,aAAa,aAAa,KAAK;QAClC,OAAO,yOAAY,CAAC,IAAI;IAC1B;IAEA,6CAA6C;IAC7C,qCAAqC;IACrC,6CAA6C;IAC7C,IAAI,aAAa,CAAC,SAAS,UAAU,CAAC,iBAAiB,CAAC,SAAS,UAAU,CAAC,WAAW;QACrF,+BAA+B;QAC/B,OAAO,yOAAY,CAAC,OAAO,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE,YAAY,UAAU,EAAE,QAAQ,GAAG;IACnF;IAEA,6CAA6C;IAC7C,kCAAkC;IAClC,6CAA6C;IAC7C,IAAI,SAAS,UAAU,CAAC,iBAAiB,SAAS,UAAU,CAAC,WAAW;QACtE,4CAA4C;QAC5C,IAAI,CAAC,OAAO;YACV,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,eAAe;YACzC,OAAO,yOAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,qBAAqB;QACrB,IAAI,SAAS,UAAU,CAAC,WAAW;YACjC,IAAI,MAAM,IAAI,KAAK,eAAe;gBAChC,OAAO,yOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;YAChE;QACF;QAEA,2BAA2B;QAC3B,IAAI,SAAS,UAAU,CAAC,eAAe;YACrC,IAAI,MAAM,IAAI,KAAK,YAAY;gBAC7B,OAAO,yOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;YACvD;QACF;IACF;IAEA,OAAO,yOAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}