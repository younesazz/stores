{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Desktop/website/ecomerceWebsite/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport type { NextRequest } from \"next/server\"\nimport { getToken } from \"next-auth/jwt\"\n\nfunction getSubdomainFromHost(host: string) {\n  const hostname = host.split(\":\")[0] // remove port\n\n  // localhost: sub.localhost (rare) OR lvh.me: sub.lvh.me\n  // if you use zaza.lvh.me -> subdomain = zaza\n  const parts = hostname.split(\".\").filter(Boolean)\n  if (parts.length < 3) return null // ex: lvh.me or localhost\n\n  return parts[0]\n}\n\nexport async function middleware(request: NextRequest) {\n  const pathname = request.nextUrl.pathname\n  const host = request.headers.get(\"host\") || \"\"\n\n  // ✅ Auth token (for dashboard/admin)\n  const token = await getToken({\n    req: request,\n    secret: process.env.NEXTAUTH_SECRET,\n  })\n\n  // ✅ Public routes\n  const publicRoutes = [\"/login\", \"/signup\", \"/api/auth\", \"/api/register\"]\n  if (publicRoutes.some((r) => pathname.startsWith(r))) {\n    return NextResponse.next()\n  }\n\n  // ✅ Ignore next internals / static\n  if (\n    pathname.startsWith(\"/_next\") ||\n    pathname.startsWith(\"/favicon.ico\") ||\n    pathname.match(/\\.(.*)$/)\n  ) {\n    return NextResponse.next()\n  }\n\n  // ✅ Subdomain detection\n  const subdomain = getSubdomainFromHost(host)\n\n  // ==========================================\n  // STORE FRONTEND (subdomain present)\n  // ==========================================\n  // Any request on zaza.lvh.me:3000/.... -> /storefront/zaza/....\n  if (subdomain && !pathname.startsWith(\"/dashboard\") && !pathname.startsWith(\"/admin\")) {\n    const url = request.nextUrl.clone()\n    url.pathname = `/storefront/${subdomain}${pathname === \"/\" ? \"\" : pathname}`\n    return NextResponse.rewrite(url)\n  }\n\n  // ==========================================\n  // PROTECT DASHBOARD / ADMIN\n  // ==========================================\n  if (pathname.startsWith(\"/dashboard\") || pathname.startsWith(\"/admin\")) {\n    if (!token) {\n      const loginUrl = new URL(\"/login\", request.url)\n      loginUrl.searchParams.set(\"callbackUrl\", pathname)\n      return NextResponse.redirect(loginUrl)\n    }\n\n    // admin only\n    if (pathname.startsWith(\"/admin\") && token.role !== \"SUPER_ADMIN\") {\n      return NextResponse.redirect(new URL(\"/dashboard\", request.url))\n    }\n\n    // tenant dashboard: block CUSTOMER\n    if (pathname.startsWith(\"/dashboard\") && token.role === \"CUSTOMER\") {\n      return NextResponse.redirect(new URL(\"/\", request.url))\n    }\n  }\n\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: [\"/((?!_next/static|_next/image|favicon.ico).*)\"],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEA,SAAS,qBAAqB,IAAY;IACxC,MAAM,WAAW,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,cAAc;;IAElD,wDAAwD;IACxD,6CAA6C;IAC7C,MAAM,QAAQ,SAAS,KAAK,CAAC,KAAK,MAAM,CAAC;IACzC,IAAI,MAAM,MAAM,GAAG,GAAG,OAAO,KAAK,0BAA0B;;IAE5D,OAAO,KAAK,CAAC,EAAE;AACjB;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;IACzC,MAAM,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,WAAW;IAE5C,qCAAqC;IACrC,MAAM,QAAQ,MAAM,IAAA,yMAAQ,EAAC;QAC3B,KAAK;QACL,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACrC;IAEA,kBAAkB;IAClB,MAAM,eAAe;QAAC;QAAU;QAAW;QAAa;KAAgB;IACxE,IAAI,aAAa,IAAI,CAAC,CAAC,IAAM,SAAS,UAAU,CAAC,KAAK;QACpD,OAAO,yOAAY,CAAC,IAAI;IAC1B;IAEA,mCAAmC;IACnC,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,mBACpB,SAAS,KAAK,CAAC,YACf;QACA,OAAO,yOAAY,CAAC,IAAI;IAC1B;IAEA,wBAAwB;IACxB,MAAM,YAAY,qBAAqB;IAEvC,6CAA6C;IAC7C,qCAAqC;IACrC,6CAA6C;IAC7C,gEAAgE;IAChE,IAAI,aAAa,CAAC,SAAS,UAAU,CAAC,iBAAiB,CAAC,SAAS,UAAU,CAAC,WAAW;QACrF,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG,CAAC,YAAY,EAAE,YAAY,aAAa,MAAM,KAAK,UAAU;QAC5E,OAAO,yOAAY,CAAC,OAAO,CAAC;IAC9B;IAEA,6CAA6C;IAC7C,4BAA4B;IAC5B,6CAA6C;IAC7C,IAAI,SAAS,UAAU,CAAC,iBAAiB,SAAS,UAAU,CAAC,WAAW;QACtE,IAAI,CAAC,OAAO;YACV,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,eAAe;YACzC,OAAO,yOAAY,CAAC,QAAQ,CAAC;QAC/B;QAEA,aAAa;QACb,IAAI,SAAS,UAAU,CAAC,aAAa,MAAM,IAAI,KAAK,eAAe;YACjE,OAAO,yOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;QAChE;QAEA,mCAAmC;QACnC,IAAI,SAAS,UAAU,CAAC,iBAAiB,MAAM,IAAI,KAAK,YAAY;YAClE,OAAO,yOAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;IACF;IAEA,OAAO,yOAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAgD;AAC5D"}}]
}