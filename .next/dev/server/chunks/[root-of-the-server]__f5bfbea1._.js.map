{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/hamaniyounes/Desktop/website/ecomerceWebsite/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient({\n  log: ['query', 'error', 'warn'],\n})\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,+OAAY,CAAC;IAC/D,KAAK;QAAC;QAAS;QAAS;KAAO;AACjC;AAEA,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///Users/hamaniyounes/Desktop/website/ecomerceWebsite/app/api/register/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/prisma\"\nimport bcrypt from \"bcryptjs\"\nimport { z } from \"zod\"\n\nconst registerSchema = z.object({\n  firstName: z.string().min(2, \"Le prénom doit contenir au moins 2 caractères\"),\n  lastName: z.string().min(2, \"Le nom doit contenir au moins 2 caractères\"),\n  email: z.string().email(\"Email invalide\"),\n  phone: z.string().min(10, \"Numéro de téléphone invalide\"),\n  password: z.string().min(8, \"Le mot de passe doit contenir au moins 8 caractères\"),\n  tenantName: z.string().min(2, \"Le nom de l'entreprise doit contenir au moins 2 caractères\"),\n  subdomain: z.string()\n    .min(3, \"Le sous-domaine doit contenir au moins 3 caractères\")\n    .max(20, \"Le sous-domaine ne peut pas dépasser 20 caractères\")\n    .regex(/^[a-z0-9-]+$/, \"Le sous-domaine ne peut contenir que des lettres minuscules, chiffres et tirets\"),\n})\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json()\n    \n    // Validation\n    const validatedData = registerSchema.parse(body)\n    \n    // Vérifier si l'email existe déjà\n    const existingUser = await prisma.user.findUnique({\n      where: { email: validatedData.email }\n    })\n    \n    if (existingUser) {\n      return NextResponse.json(\n        { error: \"Cet email est déjà utilisé\" },\n        { status: 400 }\n      )\n    }\n    \n    // Vérifier si le subdomain existe déjà\n    const existingTenant = await prisma.tenant.findUnique({\n      where: { subdomain: validatedData.subdomain }\n    })\n    \n    if (existingTenant) {\n      return NextResponse.json(\n        { error: \"Ce sous-domaine est déjà utilisé\" },\n        { status: 400 }\n      )\n    }\n    \n    // Hasher le mot de passe\n    const hashedPassword = await bcrypt.hash(validatedData.password, 10)\n    \n    // Créer le tenant et l'utilisateur dans une transaction\n    const result = await prisma.$transaction(async (tx: { tenant: { create: (arg0: { data: { name: string; subdomain: string; email: string; phone: string; status: string; trialEndsAt: Date } }) => any }; user: { create: (arg0: { data: { firstName: string; lastName: string; email: string; phone: string; password: string; role: string; tenantId: any } }) => any }; store: { create: (arg0: { data: { name: string; subdomain: string; tenantId: any; description: string } }) => any } }) => {\n      // Créer le tenant\n      const tenant = await tx.tenant.create({\n        data: {\n          name: validatedData.tenantName,\n          subdomain: validatedData.subdomain,\n          email: validatedData.email,\n          phone: validatedData.phone,\n          status: 'TRIAL',\n          trialEndsAt: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000), // 14 jours\n        }\n      })\n      \n      // Créer l'utilisateur\n      const user = await tx.user.create({\n        data: {\n          firstName: validatedData.firstName,\n          lastName: validatedData.lastName,\n          email: validatedData.email,\n          phone: validatedData.phone,\n          password: hashedPassword,\n          role: 'TENANT_ADMIN',\n          tenantId: tenant.id,\n        }\n      })\n      \n      // Créer un store par défaut\n      const store = await tx.store.create({\n        data: {\n          name: `${validatedData.tenantName} Store`,\n          subdomain: validatedData.subdomain,\n          tenantId: tenant.id,\n          description: \"Bienvenue dans votre boutique en ligne\",\n        }\n      })\n      \n      return { tenant, user, store }\n    })\n    \n    return NextResponse.json({\n      success: true,\n      message: \"Compte créé avec succès\",\n      data: {\n        userId: result.user.id,\n        tenantId: result.tenant.id,\n        subdomain: result.tenant.subdomain,\n      }\n    })\n    \n  } catch (error) {\n    console.error(\"Registration error:\", error)\n    \n    if (error instanceof z.ZodError) {\n      return NextResponse.json(\n        { error: error.issues[0].message }, // CORRECTION ICI: .issues au lieu de .errors\n        { status: 400 }\n      )\n    }\n    \n    return NextResponse.json(\n      { error: \"Une erreur est survenue lors de la création du compte\" },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":"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"}}]
}