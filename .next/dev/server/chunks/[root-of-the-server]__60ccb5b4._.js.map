{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///Users/hamaniyounes/Desktop/website/ecomerceWebsite/lib/prisma.ts"],"sourcesContent":["// lib/prisma.ts\nimport { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"query\", \"error\", \"warn\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma\n}\n"],"names":[],"mappings":";;;;AAAA,gBAAgB;AAChB;;AAEA,MAAM;AAIC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,+OAAY,CAAC;IACf,KAAK;QAAC;QAAS;QAAS;KAAO;AACjC;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/hamaniyounes/Desktop/website/ecomerceWebsite/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from \"next-auth\"\nimport CredentialsProvider from \"next-auth/providers/credentials\"\nimport { prisma } from \"@/lib/prisma\"\nimport bcrypt from \"bcryptjs\"\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    CredentialsProvider({\n      name: \"credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" }\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          throw new Error(\"Email et mot de passe requis\")\n        }\n\n        const user = await prisma.user.findUnique({\n          where: { email: credentials.email },\n          include: { tenant: true }\n        })\n\n        if (!user || !user.password) {\n          throw new Error(\"Email ou mot de passe incorrect\")\n        }\n\n        const isPasswordValid = await bcrypt.compare(\n          credentials.password,\n          user.password\n        )\n\n        if (!isPasswordValid) {\n          throw new Error(\"Email ou mot de passe incorrect\")\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: `${user.firstName} ${user.lastName}`,\n          role: user.role,\n          tenantId: user.tenantId,\n          image: user.image,\n        }\n      }\n    })\n  ],\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.id = user.id\n        token.role = user.role\n        token.tenantId = user.tenantId\n      }\n      return token\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id as string\n        session.user.role = token.role as any\n        session.user.tenantId = token.tenantId as string | null\n      }\n      return session\n    }\n  },\n  session: {\n    strategy: \"jwt\",\n    maxAge: 30 * 24 * 60 * 60, // 30 days\n  },\n  pages: {\n    signIn: \"/login\",\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n}"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAEO,MAAM,cAA+B;IAC1C,WAAW;QACT,IAAA,8MAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,OAAO,MAAM,kKAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBAAE,OAAO,YAAY,KAAK;oBAAC;oBAClC,SAAS;wBAAE,QAAQ;oBAAK;gBAC1B;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;oBAC3B,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,kBAAkB,MAAM,8IAAM,CAAC,OAAO,CAC1C,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGf,IAAI,CAAC,iBAAiB;oBACpB,MAAM,IAAI,MAAM;gBAClB;gBAEA,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,GAAG,KAAK,SAAS,CAAC,CAAC,EAAE,KAAK,QAAQ,EAAE;oBAC1C,MAAM,KAAK,IAAI;oBACf,UAAU,KAAK,QAAQ;oBACvB,OAAO,KAAK,KAAK;gBACnB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;gBACtB,MAAM,QAAQ,GAAG,KAAK,QAAQ;YAChC;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;gBAC9B,QAAQ,IAAI,CAAC,QAAQ,GAAG,MAAM,QAAQ;YACxC;YACA,OAAO;QACT;IACF;IACA,SAAS;QACP,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;IACzB;IACA,OAAO;QACL,QAAQ;IACV;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC"}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///Users/hamaniyounes/Desktop/website/ecomerceWebsite/lib/slug.ts"],"sourcesContent":["export function slugify(input: string) {\n    return input\n      .toLowerCase()\n      .trim()\n      .replace(/[^a-z0-9\\u0600-\\u06FF\\s-]/g, \"\") // يسمح بالعربي كذلك\n      .replace(/\\s+/g, \"-\")\n      .replace(/-+/g, \"-\")\n      .slice(0, 60)\n  }\n  "],"names":[],"mappings":";;;;AAAO,SAAS,QAAQ,KAAa;IACjC,OAAO,MACJ,WAAW,GACX,IAAI,GACJ,OAAO,CAAC,8BAA8B,IAAI,oBAAoB;KAC9D,OAAO,CAAC,QAAQ,KAChB,OAAO,CAAC,OAAO,KACf,KAAK,CAAC,GAAG;AACd"}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///Users/hamaniyounes/Desktop/website/ecomerceWebsite/app/api/products/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { getServerSession } from \"next-auth\"\nimport { authOptions } from \"@/lib/auth\"\nimport { prisma } from \"@/lib/prisma\"\nimport { slugify } from \"@/lib/slug\"\n\nfunction bad(msg: string, status = 400) {\n  return NextResponse.json({ error: msg }, { status })\n}\n\nexport async function GET(req: Request) {\n  const session = await getServerSession(authOptions)\n  if (!session?.user?.tenantId) return bad(\"Unauthorized\", 401)\n\n  const { searchParams } = new URL(req.url)\n  const storeId = searchParams.get(\"storeId\") || undefined\n\n  const products = await prisma.product.findMany({\n    where: {\n      store: { tenantId: session.user.tenantId },\n      ...(storeId ? { storeId } : {}),\n    },\n    include: { store: true, category: true },\n    orderBy: { createdAt: \"desc\" },\n    take: 200,\n  })\n\n  return NextResponse.json({ data: products })\n}\n\nexport async function POST(req: Request) {\n  const session = await getServerSession(authOptions)\n  if (!session?.user?.tenantId) return bad(\"Unauthorized\", 401)\n\n  const body = await req.json().catch(() => null)\n  if (!body) return bad(\"Invalid JSON\")\n\n  const {\n    storeId,\n    categoryId,\n    name,\n    slug,\n    description,\n    price,\n    comparePrice,\n    costPrice,\n    sku,\n    barcode,\n    trackInventory,\n    quantity,\n    lowStockAlert,\n    images,\n    featuredImage,\n    status,\n    isFeatured,\n    metaTitle,\n    metaDescription,\n  } = body\n\n  if (!storeId) return bad(\"storeId required\")\n  if (!name || String(name).trim().length < 2) return bad(\"name required\")\n  if (price === undefined || price === null || Number.isNaN(Number(price))) return bad(\"price required\")\n\n  // ✅ ensure store belongs to tenant\n  const store = await prisma.store.findFirst({\n    where: { id: String(storeId), tenantId: session.user.tenantId },\n    select: { id: true },\n  })\n  if (!store) return bad(\"Store not found\", 404)\n\n  const finalSlug = slugify(String(slug || name))\n  if (!finalSlug) return bad(\"Invalid slug\")\n\n  const imgs: string[] = Array.isArray(images) ? images.filter(Boolean).map(String) : []\n\n  try {\n    const created = await prisma.product.create({\n      data: {\n        storeId: String(storeId),\n        categoryId: categoryId ? String(categoryId) : null,\n        name: String(name).trim(),\n        slug: finalSlug,\n        description: description ? String(description) : null,\n        price: Number(price),\n        comparePrice: comparePrice != null ? Number(comparePrice) : null,\n        costPrice: costPrice != null ? Number(costPrice) : null,\n        sku: sku ? String(sku) : null,\n        barcode: barcode ? String(barcode) : null,\n        trackInventory: trackInventory === false ? false : true,\n        quantity: quantity != null ? Number(quantity) : 0,\n        lowStockAlert: lowStockAlert != null ? Number(lowStockAlert) : null,\n        images: imgs,\n        featuredImage: featuredImage ? String(featuredImage) : null,\n        status: status || \"DRAFT\",\n        isFeatured: Boolean(isFeatured),\n        metaTitle: metaTitle ? String(metaTitle) : null,\n        metaDescription: metaDescription ? String(metaDescription) : null,\n      },\n    })\n\n    return NextResponse.json({ data: created }, { status: 201 })\n  } catch (e: any) {\n    // unique [storeId, slug]\n    if (String(e?.code) === \"P2002\") return bad(\"Slug already exists in this store\", 409)\n    return bad(\"Failed to create product\", 500)\n  }\n}\n"],"names":[],"mappings":"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"}}]
}